<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/lib/punctuation/single-quotes.js</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../index.html">All files</a> / <a href="index.html">src/lib/punctuation</a> single-quotes.js
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>42/42</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/0</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>2/2</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">100% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>42/42</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">69x</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*
  Corrects improper use of single quotes, single primes and apostrophes
&nbsp;
  Assumptions and Limitations
  This function assumes that double quotes are always used in pair,
  i.e. authors did not forget to close double quotes in their text.
  Further, single quotes are used as secondary and they're properly spaced,
  e.g. ␣'word or sentence portion'␣ (and not like ␣'␣word␣'␣)
&nbsp;
  Algorithm
  [1] Identify common apostrohe contractions
  [2] Identify single quotes
  [3] Identify feet, arcminutes, minutes
  [4] Reconsider wrongly identified left quote and prime
  [5] Identify residual apostrophes that have left
  [6] Replace all identified punctuation with appropriate punctuation in
      given language
&nbsp;
  @param {string} string — input text for identification
  @param {string} language — language options
  @returns {string} — corrected output
*/
export function fixSingleQuotesPrimesAndApostrophes (string, locale) {
  /* [1.1] Identify ’n’ contractions */
  let pattern = '(' + locale.singleQuoteAdepts + ')(n)(' + locale.singleQuoteAdepts + ')'
  let re = new RegExp(pattern, 'gi')
  string = string.replace(re, '{{typopo__apostrophe}}$2{{typopo__apostrophe}}')
&nbsp;
  /* [1.2] Identify common contractions at the beginning or at the end
           of the word, e.g. ’em, ’cause,… */
  let contraction_examples = 'em|cause|twas|tis|til|round'
  pattern = '(' + locale.singleQuoteAdepts + ')(' + contraction_examples + ')'
  re = new RegExp(pattern, 'gi')
  string = string.replace(re, '{{typopo__apostrophe}}$2')
&nbsp;
  /* [1.3] Identify in-word contractions,
           e.g. Don’t, I’m, O’Doole, 69’ers */
  let character_adepts = locale.cardinalNumber + locale.allChars
  pattern = '([' + character_adepts + '])(' + locale.singleQuoteAdepts + locale.doubleQuoteAdepts + ')+([' + character_adepts + '])'
  re = new RegExp(pattern, 'g')
  string = string.replace(re, '$1{{typopo__apostrophe}}$3')
&nbsp;
  /* [1.4] Identify year contractions
     e.g. ’70s, INCHEBA ’89,… */
  pattern = '(' + locale.singleQuoteAdepts + ')([0-9]{2})'
  re = new RegExp(pattern, 'g')
  string = string.replace(re, '{{typopo__apostrophe}}$2')
&nbsp;
  /* [2] Identify single quotes within double quotes */
  pattern = '(' + locale.doubleQuoteAdepts + ')(.*?)(' + locale.doubleQuoteAdepts + ')'
  re = new RegExp(pattern, 'g')
  string = string.replace(re, function ($0, $1, $2, $3) {
    // identify {{typopo__left-single-quote--adept}}
    let pattern = '( )(' + locale.singleQuoteAdepts + ')([' + locale.allChars + '])'
    let re = new RegExp(pattern, 'g')
    $2 = $2.replace(re, '$1{{typopo__left-single-quote--adept}}$3')
&nbsp;
    // identify {{typopo__right-single-quote--adept}}
    pattern = '([' + locale.allChars + '])([\.,!?])?(' + locale.singleQuoteAdepts + ')([ ]|[\.,!?])'
    re = new RegExp(pattern, 'g')
    $2 = $2.replace(re, '$1$2{{typopo__right-single-quote--adept}}$4')
&nbsp;
    // identify single quote pairs around single words
    pattern = '({{typopo__left-single-quote--adept}})([' + locale.allChars + ']+)({{typopo__right-single-quote--adept}})'
    re = new RegExp(pattern, 'g')
    $2 = $2.replace(re, '{{typopo__left-single-quote}}$2{{typopo__right-single-quote}}')
&nbsp;
    // identify single quote pairs around multiple word phrases
    // (assuming such phrase will occur only once)
    pattern = '({{typopo__left-single-quote--adept}})(.*)({{typopo__right-single-quote--adept}})'
    re = new RegExp(pattern, 'g')
    $2 = $2.replace(re, '{{typopo__left-single-quote}}$2{{typopo__right-single-quote}}')
&nbsp;
    return $1 + $2 + $3
  })
&nbsp;
  /* [3] Identify feet, arcminutes, minutes
         Note: we’re not using locale.singleQuoteAdepts variable
         as commas and low-positioned quotes are ommited */
  string = string.replace(/(\d)( ?)('|‘|’|‛|′)/g, '$1{{typopo__single-prime}}')
&nbsp;
  /* [4] Reconsider wrongly identified left quote and prime
&nbsp;
     Take following example:
     He said: “What about 'Localhost 3000', is that good?”
&nbsp;
     So far, our algorithm falsely identifies prime folowing the number
     and unclosed left single quote.
     We'll find that identifications and swap it back to single quote pair.
  */
  pattern = '({{typopo__left-single-quote--adept}})(.*?)({{typopo__single-prime}})'
  re = new RegExp(pattern, 'g')
  string = string.replace(re, '{{typopo__left-single-quote}}$2{{typopo__right-single-quote}}')
&nbsp;
  /* [5] Identify residual apostrophes that have left */
  pattern = '(' + locale.singleQuoteAdepts + ')'
  re = new RegExp(pattern, 'g')
  string = string.replace(re, '{{typopo__apostrophe}}')
&nbsp;
  /* [6] Punctuation replacement */
  string = string.replace(/({{typopo__single-prime}})/g, locale.singlePrime)
  string = string.replace(/{{typopo__apostrophe}}|{{typopo__left-single-quote--adept}}|{{typopo__right-single-quote--adept}}/g, locale.apostrophe)
&nbsp;
  string = string.replace(/{{typopo__left-single-quote}}/g, locale.leftSingleQuote)
  string = string.replace(/{{typopo__right-single-quote}}/g, locale.rightSingleQuote)
&nbsp;
  return string
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="https://istanbul.js.org/" target="_blank">istanbul</a> at Mon Jul 17 2017 13:31:58 GMT+0200 (CEST)
</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
